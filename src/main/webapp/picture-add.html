<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="js/html5.js"></script>
<script type="text/javascript" src="js/respond.min.js"></script>
<script type="text/javascript" src="js/PIE_IE678.js"></script>
<![endif]-->
<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/style.css"/>       
<link href="assets/css/codemirror.css" rel="stylesheet">
<link rel="stylesheet" href="assets/css/ace.min.css" />
      <link rel="stylesheet" href="Widget/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->
<link href="Widget/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="Widget/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />

<title>添加商品</title>
</head>
<body>
<div class="clearfix" id="add_picture">
<!--<div id="scrollsidebar" class="left_Treeview">
    <div class="show_btn" id="rightArrow"><span></span></div>
    <div class="widget-box side_content" >
    <div class="side_title"><a title="隐藏" class="close_btn"><span></span></a></div>
     <div class="side_list">
      <div class="widget-header header-color-green2">
          <h4 class="lighter smaller">选择产品类型</h4>
      </div>
      <div class="widget-body">
          <div class="widget-main padding-8">
              <div  id="treeDemo" class="ztree"></div>
          </div>
  </div>
  </div>
  </div>  
  </div>-->
   <div class="page_right_style">
   <div class="type_title">添加商品</div>
	<form action="" method="post" class="form form-horizontal" id="form-article-add">
		<div class="clearfix cl">
         <label class="form-label col-2"><span class="c-red">*</span>商品名：</label>
		 <div class="formControls col-10"><input type="text" class="input-text" value="" placeholder="" id="goodsName" name=""></div>
		</div>
		<div class=" clearfix cl">
			
			<div class="Add_p_s">
            <label class="form-label col-2">产品编号：</label>
			<div class="formControls col-2"><input type="text" class="input-text" value="" placeholder="" id="goodsNumber" name=""></div>
            </div>

            <div class="Add_p_s">
             <label class="form-label col-2">品&nbsp;&nbsp;&nbsp;&nbsp;牌：</label>
			 <div class="formControls col-2">
				 <select id="goodsBrand">

				 </select>
			 </div>
			</div>
             <div class="Add_p_s">
             <label class="form-label col-2">商品类型：</label>
			 <div class="formControls col-2"><span class="select-box">
				<select class="select" id="goodsTypeParent" onchange="getGoodsType(this.value)">

				</select>
				<select class="select" id="goodsType">
					<option value="' '">请选择</option>
				</select>
				</span></div>
			</div>
            <div class="Add_p_s">
             <label class="form-label col-2">展示价格：</label>	
			 <div class="formControls col-2"><input type="text" class="input-text" value="" placeholder="" id="showPrice" name=""  >元</div>
			</div>
		</div>
		<div class="clearfix cl">
			<label class="form-label col-2">商品标题：</label>
			<div class="formControls col-10">
				<textarea name="" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)" id="goodsTitle"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>

		<div class="clearfix cl">
			<label class="form-label col-2">图片上传：</label>
			<form enctype="multipart/form-data">
				<div>主图:
				<input type="file" id="uploadFile">

				<div>附图:
				<input type="file" id="fu1">
				<input type="file" id="fu2">
				<input type="file" id="fu3">
				<input type="file" id="fu4">
			</div>
				</div>
			</form>



			&nbsp;&nbsp;&nbsp;&nbsp;

		</div>
         <div class="clearfix cl">
         <label class="form-label col-2">详细内容：</label>
			 <div id="editor"></div>
		 </div>

		<div class="clearfix cl">
			<div class="Button_operation">
				<button class="btn btn-primary radius" type="button" id="update"><i class="icon-save "></i>提交</button>
				<button onclick="addParameter(1)" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
    </div>
</div>
</div>

<script src="js/jquery-1.9.1.min.js"></script>   
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/typeahead-bs2.min.js"></script>
<script src="assets/layer/layer.js" type="text/javascript" ></script>
<script src="assets/laydate/laydate.js" type="text/javascript"></script>
<script type="text/javascript" src="Widget/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="Widget/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="Widget/zTree/js/jquery.ztree.all-3.5.min.js"></script> 
<script type="text/javascript" src="Widget/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="Widget/webuploader/0.1.5/webuploader.min.js"></script>
<script type="text/javascript" src="Widget/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="Widget/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="Widget/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script> 
<script src="js/lrtk.js" type="text/javascript" ></script>
<link rel="stylesheet" href="plugins/wangeditor/min/wangEditor.min.css" />
<script src="plugins/wangeditor/min/wangEditor.min.js"></script>
<script src="jquery/jquery-2.1.1.min.js"></script>
<script>



</script>
<script type="text/javascript">
	number =2;
	function getGoodsType(id) {
        $.ajax({
            type: 'POST',
            url: 'getAllGoodsTypeBy',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                "parentId":id
            }),
            success: function(responseText){
                var option="";
                $(responseText).each(function (index,item) {
                    option+="<option value=\""+item.id+"\">"+item.name+"</option>";
                })
                $("#goodsType").html(option);
            },
            error: function (message) {
                console.log(message);
            },
            dataType: 'json'
        });
    }

	function getGoodsTypeParent() {
        $.ajax({
            type: 'POST',
            url: 'getAllGoodsTypeBy',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                "parentId":1
            }),
            success: function(responseText){
               var option="";
                $(responseText).each(function (index,item) {
					option+="<option value=\""+item.id+"\">"+item.name+"</option>";
                })
				$("#goodsTypeParent").html(option);
            },
            error: function (message) {
                console.log(message);
            },
            dataType: 'json'
        });
    }
	function getBrand() {
        $.ajax({
            type: 'POST',
            url: 'getAllBrand',
            contentType: "application/json; charset=utf-8",
            success: function (responseText) {
                console.log(responseText);
                var option = "";
                $(responseText).each(function (index, item) {
                    option += "<option value=\"" + item.brandId + "\">" + item.brandName + "</option>";
                })
                $("#goodsBrand").html(option);
            },
            error: function (message) {
                console.log(message);
            },
            dataType: 'json'
        });
    }
	function addGoodsInfo(content) {
            /*var content = editor.txt.html();*/
		if ($("#goodsTitle").val()&&$("#goodsName").val()&&$("#goodsType").val()&&$("#goodsBrand").val()&&$("#goodsNumber").val()&&content&&$("#showPrice").val()) {
        $.ajax({
            type: 'POST',
            url: 'addGoodsInfo',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                "goodsTitle":$("#goodsTitle").val(),
				"goodsName":$("#goodsName").val(),
				"goodsTypeId":$("#goodsType").val(),
				"brandId":$("#goodsBrand").val(),
				"goodsNumber":$("#goodsNumber").val(),
				"goodsDetails":content,
				"showPrice":$("#showPrice").val()


            }),
            success: function(responseText){
               upload(responseText);
            },
            error: function (message) {
                console.log(message);
            },
            dataType: 'json'
        });}else {
		    alert("你还有东西没有填写哦")
		}
    }













    $(function () {
		getGoodsTypeParent();
        getBrand();
        var E = window.wangEditor;//声明一个wangEditor对象
        var editor = new E('#editor'); // 两个参数也可以传入 elem 对象，class 选择器
        //开启debug模式
        editor.customConfig.debug = true;
        // 关闭粘贴内容中的样式
        editor.customConfig.pasteFilterStyle = false;
        // 忽略粘贴内容中的图片
        editor.customConfig.pasteIgnoreImg = false;
        // 使用 base64 保存图片
        //editor.customConfig.uploadImgShowBase64 = true
        // 上传图片到服务器
        editor.customConfig.uploadFileName = 'editorFile'; //设置文件上传的参数名称
        editor.customConfig.uploadImgServer = 'uploadByRsx'; //设置上传文件的服务器路径
        editor.customConfig.uploadImgMaxSize = 2 * 1024 * 1024; // 将图片大小限制为 3M
        //自定义上传图片事件
        editor.customConfig.uploadImgHooks = {
            before: function(xhr, editor, files) {

            },
            success: function(xhr, editor, result) {
                console.log("上传成功");
            },
            fail: function(xhr, editor, result) {
                console.log("上传失败,原因是" + result);
            },
            error: function(xhr, editor) {
                console.log("上传出错");
            },
            timeout: function(xhr, editor) {
                console.log("上传超时");
            }
        }

        editor.create();

        $("#update").bind("click",function(){
            var content = editor.txt.html();
            addGoodsInfo(content);
        });

    })
	function upload(goodsId) {
        var formData = new FormData();
        formData.append("uploadFile",$("#uploadFile")[0].files[0])
        if ($("#fu1").val()){
            formData.append("file",$("#fu1")[0].files[0]);
        }
        if ($("#fu2").val()){
            formData.append("file",$("#fu2")[0].files[0]);
        }
        if ($("#fu3").val()){
            formData.append("file",$("#fu3")[0].files[0]);
        }
        if ($("#fu4").val()){
            formData.append("file",$("#fu4")[0].files[0]);
        }
        formData.append("goodsId",goodsId);
        $.ajax({
            url:"public/goodsUpload",
            type:"post",
            data:formData,
            processData:false,
            contentType:false,
            success:function(data){

            },
            error:function(e){
                alert("图片上传失败！！");
                location.reload();
                console.log(e);
            }
        });
    }



</script>
</body>
</html>